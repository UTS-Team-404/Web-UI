{% extends "base.html" %}

{% block head %}
    <title>Wiâ€‘Fi Intel</title>
{% endblock %}

{% block body %}

<div class="container mt-4 bg-light border" style="min-height: 200px;">

    <ul class="nav nav-tabs nav-fill justify-content-center">
        <li class="nav-item" role = "presentation">
            <button class="nav-link active" id="report-tab" data-bs-toggle="tab" data-bs-target="#report-pane" type="button" role="tab" aria-controls="pdf-pane" aria-selected="true">Wi-Fi Report</button>
        </li>
        <li class="nav-item" role = "presentation">
            <button class="nav-link" id="heat-tab" data-bs-toggle="tab" data-bs-target="#heat-pane" type="button" role="tab" aria-controls="heat-pane" aria-selected="false">Heat Map</button>
        </li>
    </ul>
    <div class="tab-content">
        <div class="tab-pane fade show active" id="report-pane" role="tabpanel" aria-labelledby="report-tab">
            <h2 class="my-3 text-center">Wi-Fi Analysis Report</h2>
            <form method="get">
                <div class="d-flex justify-content-center mb-3">

                    <select name="pid" id="pid" onchange="this.form.submit()" class="form-select" style="max-width: 100px; display: inline-block;">
                        <option value="">Proj</option>
                        {% for project in project_ids %}
                            <option value="{{ project }}" {% if project|string == selected_pid|string %}selected{% endif %}>{{ project }}</option>
                        {% endfor %}
                    </select>

                    <select name="q" id="q" onchange="this.form.submit()" class="form-select" style="max-width: 400px; display: inline-block;">
                        <option value="">-- Select SSID --</option>
                        {% for ssid in ssids %}
                            <option value="{{ ssid }}" {% if ssid|string == selected_q|string %}selected{% endif %}>{{ ssid }}</option>
                        {% endfor %}
                    </select>

                </div>
                
                <div class="d-flex justify-content-center gap-2">
                    <button class="btn btn-primary">Search</button>
                    <a href="{{ url_for('download_report', projectID=selected_pid, ssid=selected_q) }}" download class="btn btn-success">
                    Download PDF
                    </a>
                    <a href="/" class="btn btn-secondary">Reset</a>
                </div>

                <div class="text-center">

                    {% if macs %}
                    <h2 class="mt-5 mb-4">MACs for SSID: {{ selected_q or '(hidden)' }}</h2>
                    <table class="table table-striped-columns table-hover table-bordered mx-auto">
                        <tr>
                            <th>MAC (Source)</th>
                            <th>Frames</th>
                            <th>First Seen</th>
                            <th>Last Seen</th>
                            <th>Min RSSI</th>
                            <th>Avg RSSI</th>
                            <th>Max RSSI</th>
                            <th>Encryption</th>
                            <th>Authentication</th>
                        </tr>
                        {% for r in macs %}
                        <tr>
                            <td>{{ r['mac'] }}</td>
                            <td>{{ r['frames'] }}</td>
                            <td>{{ r['first_seen'] }}</td>
                            <td>{{ r['last_seen'] }}</td>
                            <td>{{ r['min_rssi'] }}</td>
                            <td>{{ r['avg_rssi'] }}</td>
                            <td>{{ r['max_rssi'] }}</td>
                            <td>{{ r['enc_types'] }}</td>
                            <td>{{ r['auth_modes'] }}</td>
                        </tr>
                        {% endfor %}
                    </table>
                    {% endif %}
                    

                </div>

                                    
            </form>
        </div>

        <div class="tab-pane fade" id="heat-pane" role="tabpanel" aria-labelledby="heat-tab">
            <h2 class="my-3 text-center">Wi-Fi Heat Map</h2>
            <div class="text-center mb-3 ratio ratio-16x9">
                <iframe 
                    src="heatmap.html" allowfullscreen 
                    style="border:none;" 
                    title="Wi-Fi Heat Map">
                </iframe>
            </div>
        </div>

    </div>

</div>
{% endblock %}
